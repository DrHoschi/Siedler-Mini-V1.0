<!-- ============================================================================
     Datei   : index.html
     Projekt : Neue Siedler (Minimal-Build, kanonischer Entry)
     Version : v25.10.25-min
     Zweck   : Minimale Startseite mit Start-Panel, Canvas (#game), Debug/Inspector-Hooks.
               Vereint Sinn aus index.html + index.demo.html, ohne Demo-Overhead.
     Autor   : Konsolidiert nach CODE_STYLE.md (Imports ‚Üí Konstanten ‚Üí Helpers ‚Üí Klassen ‚Üí Main)
============================================================================ -->

<!DOCTYPE html>
<html lang="de">
<head>
  <!-- ========================================================================
       [HEAD] Meta & Basis-Styles
       - Mobile-freundlich, Vollbild-Canvas, sicheres Z-Index-Layering
  ======================================================================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light dark" />
  <title>Neue Siedler ‚Äì Minimal</title>

    <link rel="stylesheet" href="ui/css/ui-start.css">
  
  <style>
    /* =========================================================================
       [STYLE] Minimal-Layering & Reset
       - #app ist Container (Flex, 100vh)
       - #game (Canvas) liegt unten, Overlays (Startpanel/Inspector) dar√ºber
       - Keine externen CSS-Abh√§ngigkeiten im Minimal-Setup
    ========================================================================= */
    html, body { height: 100%; margin: 0; padding: 0; }
    body { background: #1b1b1b; color: #eaeaea; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    #app { position: relative; width: 100vw; height: 100vh; overflow: hidden; display: flex; }

    /* Canvas (#game) ‚Äì bleibt dein kanonisches Ziel */
    #game {
      display: block;
      margin: 0;
      width: 100%;
      height: 100%;
      background: #0a0a0a;
      image-rendering: pixelated;    /* wichtig f√ºr Retro/Sprites */
      touch-action: none;            /* verhindert Scroll/Zoom-Gesten */
    }

    /* Startpanel (oben) ‚Äì zuerst sichtbar, blockiert Interaktionen bis Start */
    #start-panel {
      position: absolute;
      inset: 0;
      z-index: 100;                  /* √ºber Canvas, unter Inspector (falls ge√∂ffnet) */
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.66);
      backdrop-filter: blur(2px);
    }
    .start-card {
      width: min(92vw, 520px);
      border: 2px solid #6e4a28;           /* Holzrahmen-Anmutung (placeholder) */
      background: #2a211a;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      padding: 18px 18px 10px;
      border-radius: 10px;
    }
    .start-card h1 { margin: 0 0 8px; font-size: 22px; color: #f0d9b5; }
    .start-card p  { margin: 0 0 14px; color: #d7c6a5; font-size: 14px; line-height: 1.4; }
    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      appearance: none; border: none; cursor: pointer;
      padding: 10px 14px; border-radius: 6px; font-weight: 700;
      background: #8b5a2b; color: #fff;
    }
    .btn.secondary { background: #39424e; }
    .btn:active { transform: translateY(1px); }

    /* Floating Buttons (unten rechts): Inspector & Fullscreen ‚Äì Debug bleibt! */
    .fab {
      position: absolute; right: 12px; bottom: 12px; z-index: 120;
      display: flex; flex-direction: column; gap: 10px;
    }
    .fab button {
      width: 44px; height: 44px; border-radius: 10px; border: none; cursor: pointer;
      background: #2e3440; color: #eaeaea; font-weight: 800; font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    }

    /* Inspector-Mini (minimaler Platzhalter ‚Äì echte Tabs sp√§ter in ui/ui-inspector.js) */
    #inspector {
      position: absolute; inset: 5% 5% auto 5%; height: 40%;
      z-index: 200; background: #111; border: 1px solid #444; border-radius: 8px;
      display: none; flex-direction: column;
    }
    #inspector header {
      padding: 8px 10px; background: #2b2b2b; color: #ddd; font-weight: 700;
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid #444;
    }
    #inspector pre {
      margin: 0; padding: 10px; overflow: auto; color: #cbd5e1; flex: 1;
    }

    /* Noscript-Hinweis */
    .noscript {
      position: absolute; inset: 0; display: grid; place-items: center; z-index: 9999;
      background: #000; color: #fff; font-size: 16px; text-align: center; padding: 20px;
    }
  </style>
</head>

<body data-build="v25.10.25-min" data-env="dev" data-entry="index">
  <!-- ========================================================================
       [ROOT] App-Container & Canvas
       - #game ist dein kanonisches Canvas (du wolltest explizit "#game" beibehalten)
  ======================================================================== -->
  <div id="app" aria-label="Spielcontainer">
    <canvas id="game" aria-label="Game Canvas (#game)"></canvas>

    <!-- ======================================================================
         [UI] Startpanel ‚Äì zuerst sichtbar
         Events:
         - Klick auf "Starten" ‚Üí dispatch 'req:ui:start'
         - Danach: Panel verstecken, 'cb:ui-ready' & 'cb:game:start' werden vom Boot ausgel√∂st
    ======================================================================= -->
    <section id="start-panel" aria-label="Startpanel">
      <div class="start-card" role="dialog" aria-modal="true">
        <h1>Neue Siedler (Minimal)</h1>
        <p>
          Minimalstart mit Canvas, Registry-Boot und Debug-Buttons.
          Sp√§ter ersetzen wir dieses Inline-UI durch <code>ui/ui-start.js</code>.
        </p>
        <div class="btn-row">
          <button id="btn-start" class="btn">Spiel starten</button>
          <button id="btn-continue" class="btn secondary">Weiterspielen (sp√§ter)</button>
          <button id="btn-reset" class="btn secondary">Reset (sp√§ter)</button>
        </div>
      </div>
    </section>

    <!-- ======================================================================
         [UI] Debug/Inspector Floating Buttons ‚Äì bleiben persistent im Projekt
    ======================================================================= -->
    <div class="fab" aria-label="Schnellzugriff Debug/Inspector">
      <button id="btn-inspector" title="Inspector an/aus">üõ†Ô∏è</button>
      <button id="btn-fullscreen" title="Vollbild">‚õ∂</button>
    </div>

    <!-- ======================================================================
         [UI] Minimaler Inspector-Platzhalter (Logs)
         - Echte Tabs (Logs/Tests/Ressourcen/Pfade/Editor) folgen in ui/ui-inspector.js
    ======================================================================= -->
    <aside id="inspector" aria-label="Inspector (Minimal)">
      <header>
        <span>Inspector ‚Äì Logs</span>
        <button id="btn-inspector-close" class="btn secondary" style="padding:6px 10px">Schlie√üen</button>
      </header>
      <pre id="inspector-log" aria-live="polite">[info] Inspector bereit (minimal)</pre>
    </aside>

    <noscript>
      <div class="noscript">
        <p><strong>JavaScript ist deaktiviert.</strong><br>
        Bitte aktiviere JavaScript, um das Spiel zu starten.</p>
      </div>
    </noscript>
  </div>

  <!-- ========================================================================
       [SCRIPTS] Reihenfolge gem√§√ü Standard
       1) Basissystem (Logs, Events, Env)
       2) Assets/Boot/Registry
       3) Engine (Game, Map, Render, Camera, Input, Entities, PF, Carrier)
       4) Overlays
       5) Minimal-UI (inline) ‚Äì ersetzt sp√§ter ui/ui-*.js
       WICHTIG:
       - keine Demo-/Docs-Skripte hier einbinden
       - keine *.jsonc laden (nur .json im Build)
  ======================================================================== -->

  <!-- [1] Basissystem -->
  <script src="core/cblog.polyfill.js"></script>
  <script src="core/eventbus.js"></script>
  <script src="core/core.env.js"></script>

  <!-- [2] Assets/Boot/Registry -->
  <script src="core/asset.js"></script>
  <script src="core/boot.js"></script>
  <script src="core/registry.js"></script> <!-- Registry: Single Source of Truth (IDs, Farben, Icons) -->

  <!-- [3] Engine -->
  <script src="core/game.js"></script>
  <script src="core/core.map.js"></script>
  <script src="core/core.render.js"></script>
  <script src="core/camera.js"></script>
  <script src="core/zoom.js"></script>
  <script src="core/core.input.js"></script>
  <script src="core/core.entities.js"></script>
  <script src="core/core.pfglue.js"></script>
  <script src="core/carrier.js"></script>

  <!-- [4] Overlays (einheitliche Initialisierung nur aus boot.js!) -->
  <script src="core/overlay-hooks.js"></script>
  <script src="core/path-overlay.js"></script>
  <script src="core/unit-overlay.js"></script>

  <!-- ========================================================================
       [5] Minimal-UI Inline (Startpanel, Inspector, Fullscreen)
       - Ersetzt sp√§ter: ui/ui-start.js, ui/ui-inspector.js
       - H√§lt sich strikt an Event-Flow (req:/cb:)
  ======================================================================== -->
    <script src="ui/ui-start.js"></script>
  
  <script>
  /* ==========================================================================
     [UI-MIN] Konstanten & kleine Helpers
  ========================================================================== */
  const $ = (sel, root=document) => root.querySelector(sel);
  const logOK = (msg) => (window.CBLog?.ok || console.log)(msg);
  const emit  = (name, detail={}) => window.dispatchEvent(new CustomEvent(name, { detail }));

  /* ==========================================================================
     [UI-MIN] Startpanel-Logik
     - Klick "Starten" ‚Üí req:ui:start
     - Boot/Engine reagieren, feuern cb:ui-ready / cb:game-start / cb:assets-ready / cb:registry:ready etc.
  ========================================================================== */
  (function initStartPanel(){
    const startPanel = $('#start-panel');
    const btnStart   = $('#btn-start');
    const btnCont    = $('#btn-continue');
    const btnReset   = $('#btn-reset');

    btnStart?.addEventListener('click', () => {
      logOK('[ui] Start angefordert ‚Üí req:ui:start');
      emit('req:ui:start');
      // Panel nicht sofort verstecken ‚Äì warte auf Best√§tigung vom Boot/Game:
      // Wenn Boot bereit, UI schlie√üen:
      window.addEventListener('cb:game-start', () => {
        startPanel.style.display = 'none';
      }, { once: true });
    });

    btnCont?.addEventListener('click', () => {
      (window.CBLog?.info || console.info)('[ui] Continue (sp√§ter implementiert)');
      // sp√§ter: emit('req:ui:continue')
    });
    btnReset?.addEventListener('click', () => {
      (window.CBLog?.warn || console.warn)('[ui] Reset (sp√§ter implementiert)');
      // sp√§ter: emit('req:ui:reset-confirm')
    });

    // Signalisieren, dass das Start-UI bereit ist
    emit('cb:ui-ready', { from: 'index', version: document.body.dataset.build });
  })();

  /* ==========================================================================
     [UI-MIN] Inspector-Toggle (Platzhalter)
     - Button unten rechts √∂ffnet/ schlie√üt Minimal-Inspector
     - Sp√§ter ersetzt durch ui/ui-inspector.js mit Tabs (Logs/Tests/Ressourcen/Pfade/Editor)
  ========================================================================== */
  (function initInspector(){
    const pane  = $('#inspector');
    const logp  = $('#inspector-log');
    const open  = $('#btn-inspector');
    const close = $('#btn-inspector-close');

    function toggle(show){
      pane.style.display = show ? 'flex' : 'none';
      if (show) {
        logp.textContent += '\n[info] ' + new Date().toISOString() + ' ‚Äì Inspector ge√∂ffnet';
      }
    }
    open?.addEventListener('click', () => toggle(pane.style.display === 'none' || pane.style.display === ''));
    close?.addEventListener('click', () => toggle(false));

    // Beispiel: h√∂re auf ein paar Kern-Events und schreibe sie ins Log
    const echo = (name) => window.addEventListener(name, (e) => {
      logp.textContent += `\n[event] ${name} ${(e.detail)? JSON.stringify(e.detail): ''}`;
      logp.scrollTop = logp.scrollHeight;
    });
    ['cb:assets-ready','cb:registry:ready','cb:game-start','cb:res:change'].forEach(echo);

    logOK('[inspector] minimal bereit');
  })();

  /* ==========================================================================
     [UI-MIN] Fullscreen-Button (optional)
  ========================================================================== */
  (function initFullscreen(){
    const btn = $('#btn-fullscreen');
    btn?.addEventListener('click', async () => {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
        } else {
          await document.exitFullscreen();
        }
      } catch (err) {
        (window.CBLog?.error || console.error)('Fullscreen-Fehler:', err);
      }
    });
  })();

  /* ==========================================================================
     [UI-MIN] Boot-Kickoff (Fallback)
     - Falls dein boot.js das Game nicht automatisch startet, sto√üen wir es hier explizit an.
     - Wichtig: Das eigentliche Starten / Laden soll in boot.js geregelt sein.
  ========================================================================== */
  (function kickoff(){
    if (typeof window.GameBoot?.start === 'function') {
      logOK('[index] Starte GameBoot.start()');
      window.GameBoot.start({ canvasId: 'game' });
      // Boot selbst soll cb:game-start emittieren, sobald alles verdrahtet ist.
    } else {
      // Minimaler Fallback: signalisieren, dass wir bereit sind; Game kann sp√§ter anh√§ngen
      (window.CBLog?.warn || console.warn)('[index] GameBoot.start() nicht gefunden ‚Äì Boot startet extern');
      emit('req:boot:start', { canvasId: 'game' });
    }
  })();
  </script>
</body>
</html>
